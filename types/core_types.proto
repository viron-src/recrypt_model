// Copyright © Viron Software ⨈
syntax = "proto3";
package recrypt.types;
import "google/protobuf/timestamp.proto";

// The enum Currency and enum Market aren't used directly
// since they are 64-bit keys in the backend and protobuf enums are 32-bit.
// This is documented accordingly next to the field when values within those enums can be specified.

// Use the enum list here for integers that refer to the enum name as a comment.
// currency_seq int64 values
enum Currency {
  CURRENCY_UNSPECIFIED = 0;
  CURRENCY_AUSTRALIAN_DOLLAR = 1;
  CURRENCY_BITCOIN = 2;
  CURRENCY_ETHEREUM = 3;
}
// market_seq int64 values
enum Market {
  MARKET_UNSPECIFIED = 0;
  MARKET_BTC_AUD = 1;
  MARKET_ETH_AUD = 2;
}
// int32 values
enum OrderSide {
  BUY = 0;
  SELL = 1;
}
// int32 values
enum OrderType {
  LIMIT = 0;
  MARKET = 1;
}
// int32 values
enum OrderTimeInForce {
  GOOD_TIL_CANCELLED = 0;
  IMMEDIATE_OR_CANCEL = 1;
  FILL_OR_KILL = 2;
}
// int32 values
enum OrderStatus {
  STATUS_FILLED = 0;
  STATUS_PARTIALLY_FILLED = 1;
  STATUS_PENDING = 2;
  STATUS_REJECTED = 3;
}
// int32 values
enum OrderState {
  STATE_OPEN = 0;
  STATE_PARTIALLY_FILLED = 1;
  STATE_FILLED = 2;
  STATE_CANCELLED = 3;
  STATE_EXPIRED = 4;
}
// int32 values
enum OrderRole {
  ROLE_MAKER = 0;
  ROLE_TAKER = 1;
}

message SystemFeedRequest {
  int64 session_seq = 1;
  bool request_global_currency_data = 2;
}

message SystemFeedSubscribeRequest {
  int64 session_seq = 1;
  repeated int64 market_seqs = 2; // enum Markets. Maximum three markets. If require more create more API keys.
  bool anonymous = 3; // Unless you're trying to reverse engineer how the frontend works set this as false always.
}

message SystemFeedSubscribeResponse {
  repeated int64 subscribed_market_seqs = 1; // enum Markets. List of markets subscribed to.
  repeated int64 unsubscribed_market_seqs = 2; // enum Markets. List of markets that was just unsubscribed from.
}

// --- BEGIN SYSTEM FEED MESSAGE TYPES
message FeedNotification {
  int64 dedupe_seq = 1;
  string title = 2;
  string message = 3;
}

message FeedNotice {
  // Displayed on the front-end.
  string notice_manual = 1;
  string notice_auto = 2;
}

message GlobalCurrencyData {
  repeated GlobalCurrencyDataEntry data = 1;
}

message GlobalCurrencyDataEntry {
  int64 seq = 1; // enum Currency
  string short_name = 2;
  string full_name = 3;
  int32 friendly_decimal_places = 4;
  int32 all_decimal_places = 5;
  int32 required_confirmations = 6;
  string icon = 7; // SVG
  repeated int32 network_identifiers = 8;
}

message DepositDeleted {
  string tx_id = 1;
}

message BalanceAdjusted {
  int64 currency_seq = 1;
}

message OrderMatched {
  int64 currency_seq_1 = 1;
  int64 currency_seq_2 = 2;
  int64 market_seq = 3;
  ListTradeItem trade = 4; // Used for live updating trade history tab.
  ListOrderItem order_update = 5; // null if order_closed is specified.
  ListOrderItem order_closed = 6; // null if order was not closed.
}

message OrderCancelled {
  int64 currency_seq_1 = 1;
  int64 currency_seq_2 = 2;
  int64 market_seq = 3;
  ListOrderItem order = 4; // Used for live updating order tab.
}

message OrderPlaced {
  int64 currency_seq_1 = 1;
  int64 currency_seq_2 = 2;
  int64 market_seq = 3;
  bool closed = 4;
  ListOrderItem order = 5; // Used for live updating order tab.
}

message FeeDiscountUpdate {
  string fee_percent_discount = 1;
}

// MarketState is pushed through during:
// 1. New SystemFeed connection and an associated API key was already was subscribed to certain markets previously.
// 2. SystemFeedSubscribe was just called on the same API key. The state of just-subscribed markets will be re-sent.
// 3. Database failover occurred and new whole state needed to be pushed again.
// In the event this message comes through, make sure to clear out existing in-memory order book data.
message MarketState {
  int64 market_seq = 1;
  repeated MarketOrderBookAdded order_book = 2; // ALL buy/sell orders. Order by BUY's then SELLS. Descending price for both.
  repeated MarketMatch recent_matches = 3; // Most recent 50 settled trades.
  repeated MarketMatch recent_matches_myself = 5; // Most recent 50 settled trades (filtered by your account).
  MarketPrice price = 4; // The latest price as part of this state.
  MarketStats stats = 6;
  repeated Candlestick candles = 7; // This will only be provided for front-end feeds at 1 second interval. It will be empty during API usage. Refer to GetCandlesticks API then use pushed price updates.
}

message MarketOrderBookAdded {
  int64 market_seq = 1;
  int64 order_book_seq = 2;
  string price = 3; // Decimal
  string quantity = 4; // Decimal
  OrderSide side = 5;
}

// Occurs when an order gets partially fulfilled.
message MarketOrderBookAdjusted {
  int64 market_seq = 1;
  int64 order_book_seq = 2;
  string quantity = 3; // Decimal
}

message MarketOrderBookRemoved {
  int64 market_seq = 1;
  int64 order_book_seq = 2;
}

message MarketMatch {
  int64 market_seq = 1;
  int64 match_seq = 2; // Since 27 Jan 2026: this is transaction seq and can be multiple of same sequence grouped by price and time.
  string price = 3; // Decimal
  string quantity = 4; // Decimal
  OrderSide side = 5; // The side of the order of which the match was triggered.
  google.protobuf.Timestamp tstamp = 6;
  bool trend_up = 7; // Relative to previous match price.
}

message MarketPrice {
  int64 market_seq = 1;
  string price = 2; // Decimal. If zero, no trades have ever occurred on this market.
  int64 epoch_second = 3;
  bool trend_up = 4;
}

message MarketStats {
  int64 market_seq = 1;
  string hour24price = 2; // Decimal
  string hour24high = 3; // Decimal
  string hour24low = 4; // Decimal
  string hour24volbase = 5; // Decimal
  string hour24volquote = 6; // Decimal
  string min15volbase = 7; // Decimal
  string min15volquote = 8; // Decimal
}

message MarketStatsMini {
  int64 market_seq = 1;
  string price = 2;
  string hour24price = 3;
}

message AnonFeedSessionInfo {
  int64 anon_seq = 1;
  string anon_key = 2;
}

message SubscriptionInfo {
  repeated int64 market_seqs = 1;
}

message SystemFeedData {
  oneof message {
    google.protobuf.Timestamp ping = 1;
    FeedNotification feed_notification = 2;
    FeedNotice feed_notice = 3;
    GlobalCurrencyData global_currency_data = 4;
    GetDepositsReceivedEntry deposit_received = 5;
    DepositDeleted deposit_deleted = 6;
    BalanceAdjusted balance_adjusted = 14;
    OrderMatched order_matched = 15;
    OrderCancelled order_cancelled = 16;
    OrderPlaced order_placed = 17;
    FeeDiscountUpdate fee_discount_update = 22; // Pushed after SubscriptionInfo and every time the fee discount value has changed for the account.

    MarketState market_state = 7; // Refer to comment above MarketState type.
    MarketOrderBookAdded market_order_book_added = 8; // Sent for every order added for all subscribed markets.
    MarketOrderBookAdjusted market_order_book_adjusted = 9; // Sent for every order updated for all subscribed markets.
    MarketOrderBookRemoved market_order_book_removed = 10; // Sent for every order removed for all subscribed markets.
    MarketMatch market_match = 11; // Sent every match for all subscribed markets.
    MarketMatch market_match_myself = 19; // Sent every match (filtered by your account only) for all subscribed markets.
    MarketPrice market_price = 12; // Sent every price change for all subscribed markets. There can me multiple prices per epoch second.
    MarketStats market_stats = 20; // Sent every 30 to 60 seconds for all subscribed markets.
    MarketStatsMini market_stats_mini = 21; // Unless you're trying to reverse engineer how the frontend works ignore this message.

    // This is only returned at start of an anonymous system feed connection. Unless you're trying to reverse engineer how the frontend works ignore this message.
    AnonFeedSessionInfo anon_feed_session_info = 13;
    // This is return at start of all system feed stream returning a list of markets that are already subscribed to.
    SubscriptionInfo subscription_info = 18;
  }
}
// END SYSTEM FEED MESSAGE TYPES ---

message ValidateAddressRequest {
  int64 session_seq = 1;
  int64 currency_seq = 2; // enum Currency
  int32 network_identifier = 3;
  string address = 4; // Minimum 8 characters, maximum 128 characters.
}

message ValidateAddressResponse {
  string balance = 1; // Will be "" if not applicable.
}

message AllocateDepositAddressRequest {
  int64 session_seq = 1;
  int64 currency_seq = 2; // enum Currency
}

message AllocateDepositAddressResponse {
}

message GetDepositAddressesRequest {
  int64 session_seq = 1;
  int64 currency_seq = 2; // enum Currency
}

message GetDepositAddressesResponse {
  repeated string addresses = 1;
  string min_deposit = 2; // Decimal
}

message GetDepositsReceivedRequest {
  int64 session_seq = 1;
  google.protobuf.Timestamp start_tstamp = 2; // PAGING SUPPORT: Can be null. If provided 'end_tstamp' must also be provided.
  google.protobuf.Timestamp end_tstamp = 3; // PAGING SUPPORT: Can be null. Both null if showing latest data, otherwise showing rows before 'end_tstamp'.
}

message GetDepositsReceivedResponse {
  // Maximum 100 rows returned. Take last entry tstamp and specify it as end_tstamp to continue if rows returned was not zero.
  repeated GetDepositsReceivedEntry deposits = 1;
  int32 total_rows = 2; // Can be greater than 100. Represents all row count given current filters/paging.
}

message GetDepositsReceivedEntry {
  int64 currency_seq = 1; // enum Currency
  string value = 2; // Decimal
  // td_id has the following format for each currency:
  // BTC/LTC/BCH/DOGE: [block-hash]-[transaction hash]-[output index]
  // ETH: [block-hash]-[transaction hash]
  // ADA: [block-number]-[transaction hash]-[output index]
  string tx_id = 3;
  bool pending = 4;
  bool blocked = 5;
  int32 confirmations = 6;
  google.protobuf.Timestamp tstamp = 7;
  bool is_new = 8; // Only used for live updates when returned from system feed.
}

message GetBalancesRequest {
  int64 session_seq = 1;
  bool exclude_order_book = 2;
}

message GetBalancesResponse {
  repeated GetBalancesEntry balances = 1;
  google.protobuf.Timestamp tstamp = 2; // Evaluated 'as at' timestamp.
}

message GetBalancesEntry {
  int64 currency_seq = 1; // enum Currency
  string balance = 2; // Decimal
}

message MaintenanceCheckRequest {
}

message MaintenanceCheckResponse {
  // Please read readme.md: Section 'Retry on failure'.
  // Most downtime only lasts 1 minute within a 30 minute timespan from event_tstamp.
  bool upcoming_event = 1; // TRUE if any maintenance that'll result in downtime is upcoming.
  bool ongoing_event = 2; // TRUE if an ongoing scheduled or unscheduled event is active.
  google.protobuf.Timestamp event_tstamp = 3; // When upcoming_event or ongoing_event is true this will be set.
}

message GetTransactionsRequest {
  int64 session_seq = 1;
  repeated int64 currency_seqs = 2; // enum Currency. Optional extra filter. Empty means all currencies.
  google.protobuf.Timestamp start_tstamp = 3; // PAGING SUPPORT: Can be null. If provided 'end_tstamp' must also be provided.
  google.protobuf.Timestamp end_tstamp = 4; // PAGING SUPPORT: Can be null. Both null if showing latest data, otherwise showing rows before 'end_tstamp'.
}

message GetTransactionsResponse {
  // Maximum 100 rows returned. Take last entry tstamp and specify it as end_tstamp to continue if rows returned was not zero.
  repeated GetTransactionsEntry transactions = 1;
  int32 total_rows = 2; // Can be greater than 100. Represents all row count given current filters/paging.
  google.protobuf.Timestamp tstamp = 3; // Evaluated 'as at' timestamp.
}

message GetTransactionsEntry {
  int64 seq = 1;
  int64 currency_seq = 2; // enum Currency
  int32 type = 3;
  string balance_change = 4; // Decimal
  string system_note = 5;
  google.protobuf.Timestamp tstamp = 6;
}

message GetMarketsRequest {
}

message GetMarketsResponse {
  repeated GetMarketsEntry markets = 1;
}

message GetMarketsEntry {
  int64 seq = 1; // enum Market
  int64 base_currency_seq = 2; // enum Currency
  int64 quote_currency_seq = 3; // enum Currency
  string maker_fee_percent = 4; // Decimal
  string taker_fee_percent = 5; // Decimal
  repeated string depth_aggs = 6; // Decimal
  string price = 7; // Decimal
  string hour24price = 8; // Decimal
}

message OrderRequest {
  int64 session_seq = 1;
  int64 market_seq = 2; // enum Market
  OrderSide side = 3;
  OrderType type = 4;
  optional OrderTimeInForce time_in_force = 5; // Required for OrderType limit orders, otherwise leave unset.
  optional string quantity = 6; // Decimal // Required for OrderType limit orders. For OrderType market orders either quantity or quote_order_quantity must be set.
  optional string price = 7; // Decimal // Required for OrderType limit orders otherwise leave unset.
  optional string quote_order_quantity = 8; // Decimal. // Leave unset for OrderType limit orders. For OrderType market orders either quantity or quote_order_quantity must be set.
  optional string idempotency_key = 9; // Refer to readme.md.
}

message OrderFill {
  string price = 1; // Decimal
  string quantity = 2; // Decimal
  string commission = 3; // Decimal
  int64 commission_currency_seq = 4; // enum Currency
  int64 order_seq = 5; // The pre-existing order seq that was matched against. This may refer to an order ID from another account.
  int64 trade_seq = 6; // New match detail record seq. Refer to ListTradeItem.seq.
}

message OrderResponse {
  OrderStatus status = 1;
  optional int64 order_seq = 2; // Provided when OrderStatus is not STATUS_REJECTED.
  repeated OrderFill fills = 3;
}

message CancelOrderRequest {
  int64 session_seq = 1;
  int64 market_seq = 2; // enum Market
  int64 order_seq = 3;
}

message CancelOrderResponse {
}

message ListOrdersRequest {
  int64 session_seq = 1;
  int64 market_seq = 2; // enum Market
  // At-least one of the following four booleans must be true.
  bool list_open_orders = 3; // List any open pending orders.
  bool list_order_history_filled = 4; // List any filled or partially filled orders.
  bool list_order_history_cancelled = 5; // List any cancelled or expired orders.
  bool list_trades = 6; // List all completed trades. There can be multiple trades from a single order.
  google.protobuf.Timestamp start_tstamp = 7; // PAGING SUPPORT: Can be null. If provided 'end_tstamp' must also be provided.
  google.protobuf.Timestamp end_tstamp = 8; // PAGING SUPPORT: Can be null. Both null if showing latest data, otherwise showing rows before 'end_tstamp'.
}

message ListOrdersResponse {
  // Only a maximum of 100 rows will be returned here. Refer to ListOrdersRequest start_tstamp and end_tstamp.
  // If returned rows is equal to 100, consider setting end_tstamp to the last entry to page backwards in time.
  repeated ListOrdersEntry entry = 1;
  int32 total_rows = 2; // Can be greater than 100. Represents all row count given current filters/paging.
}

message ListOrdersEntry {
  oneof item {
    ListOrderItem order = 1;
    ListTradeItem trade = 2;
  }
}

message ListOrderItem {
  int64 order_seq = 1; // Unique globally for all order requests.
  OrderSide side = 2;
  OrderType type = 3;
  string original_quantity = 4;
  string remaining_quantity = 5; // original_quantity minus remaining_quantity to get the filled quantity.
  optional string price = 6; // Price will be null/unspecified in some cases, e.g. market order. Refer to trade list for the prices that were matched.
  OrderState state = 7;
  google.protobuf.Timestamp created_tstamp = 8;
  google.protobuf.Timestamp closed_tstamp = 9; // Market orders always have closed_tstamp equal to created_stamp. closed_tstamp can be null if the order is still open on the order book.
  google.protobuf.Timestamp tstamp = 10; // This is the sorted field. For open orders this is created_tstamp, otherwise this would be closed_tstamp.
}

message ListTradeItem {
  int64 trade_seq = 1; // Unique globally for all trades/matches.
  int64 order_seq = 2; // Refers to ListOrderItem.seq.
  OrderSide side = 3;
  OrderType type = 4;
  OrderRole role = 5;
  string price = 6;
  string quantity = 7;
  string commission = 8; // Decimal
  int64 commission_currency_seq = 9; // enum Currency
  google.protobuf.Timestamp tstamp = 10;
}

message GetFeeStructureRequest {
}

message GetFeeStructureResponse {
  repeated GetFeeStructureMarketEntry markets = 1;
  repeated GetFeeStructureDiscountEntry discounts = 2;
}

message GetFeeStructureMarketEntry {
  int64 seq = 1; // enum Market
  int64 base_currency_seq = 2; // enum Currency
  int64 quote_currency_seq = 3; // enum Currency
  string maker_fee_percent = 4; // Decimal
  string taker_fee_percent = 5; // Decimal
}

message GetFeeStructureDiscountEntry {
  string volume = 1; // Decimal
  string extra_discount_percent = 2; // Decimal
}

message GetUnallocatedBalancesRequest {
  int64 session_seq = 1;
  repeated int64 currency_seqs = 2;
}

message GetUnallocatedBalancesResponse {
  repeated GetUnallocatedBalancesEntry balances = 1;
  google.protobuf.Timestamp tstamp = 2; // Evaluated 'as at' timestamp.
}

message GetUnallocatedBalancesEntry {
  int64 currency_seq = 1; // enum Currency
  string unallocated_available = 2; // Decimal
}

message Candlestick {
  int64 epoch_start = 1;
  int64 epoch_end = 2;
  string start = 3; // Decimal
  string end = 4; // Decimal
  string high = 5; // Decimal
  string low = 6; // Decimal
}

message GetCandlesticksRequest {
  int64 market_seq = 1;
  int32 epoch_interval = 2; // Supported values are 604800 (1 week), 86400 (1 day), 10800 (3 hour), 3600 (1 hour), 900 (15 minute), 300 (5 minute), 1 (1 second)
}

message GetCandlesticksResponse {
  repeated Candlestick candles = 1;
}